# Misskey-rs 未実装機能一覧

このドキュメントはMisskey本家との機能差分と実装タスクを管理します。

**設計方針: 単なる互換実装ではなく、上位互換・改良版として実装する**

*Last Updated: 2025-12-11*

---

## 設計思想

### 本家Misskeyの課題と改善方針

| 課題 | 改善方針 |
|------|---------|
| TypeScriptの型安全性の限界 | Rustの型システムで完全な型安全性を保証 |
| N+1クエリ問題 | バッチ処理・DataLoader パターンの徹底 |
| メモリ効率 | ゼロコピー・ストリーミング処理 |
| 巨大サービスクラス | 単一責任原則に基づく小さなサービス |
| エラーハンドリングの不統一 | Result型による一貫したエラー処理 |
| APIの一貫性のなさ | RESTful + GraphQL の統一的API設計 |
| フェデレーション互換性問題 | 厳密なActivityPub準拠 + 拡張の明確な分離 |

### 上位互換として目指すもの

1. **パフォーマンス**: 本家の10倍以上のスループット
2. **型安全性**: コンパイル時に検出可能なエラーの最大化
3. **API設計**: GraphQL対応、バッチAPI、より直感的なエンドポイント
4. **拡張性**: プラグインシステム、Webhook、カスタムイベント
5. **運用性**: より詳細なメトリクス、管理機能の強化
6. **標準準拠**: ActivityPub/WebFinger/NodeInfoの厳密な準拠

---

## Phase 1: 基本機能補完

### 1.1 クリップ機能（上位互換）✅ 実装済み

**本家の課題:**
- クリップ内の検索ができない
- ノートの順序変更ができない
- クリップ間のノート移動が面倒

**改善実装:**
- [x] クリップエンティティ作成 (`clip`, `clip_note`)
- [x] クリップリポジトリ実装
- [x] クリップサービス実装
- [x] APIエンドポイント実装
  - [x] POST `/clips/create` - クリップ作成
  - [x] POST `/clips/update` - クリップ更新
  - [x] POST `/clips/delete` - クリップ削除
  - [x] POST `/clips/list` - クリップ一覧
  - [x] POST `/clips/show` - クリップ詳細
  - [x] POST `/clips/add-note` - ノート追加
  - [x] POST `/clips/remove-note` - ノート削除
  - [x] POST `/clips/notes` - クリップ内ノート一覧
  - [x] POST `/clips/reorder` - クリップ順序変更
  - [x] POST `/clips/reorder-notes` - クリップ内ノート順序変更
  - [x] POST `/clips/find-note` - ノートが含まれるクリップを検索
- [ ] ActivityPub対応（Collection）
- [ ] **[拡張]** クリップ内検索機能
- [x] **[拡張]** ノートの順序変更
- [ ] **[拡張]** クリップ間ノート移動/コピー
- [ ] **[拡張]** クリップのネスト（フォルダ構造）
- [ ] **[拡張]** スマートクリップ（条件ベース自動追加）
- [ ] **[拡張]** クリップの共有・コラボレーション

### 1.2 ノートピン留め（上位互換）✅ 実装済み

**本家の課題:**
- ピン留め数の制限が固定
- カテゴリ分けができない

**改善実装:**
- [x] ユーザーエンティティに `pinned_note_ids` 追加
- [x] ピン留めサービス実装
- [x] APIエンドポイント実装
  - [x] POST `/users/pin` - ノートをピン留め
  - [x] POST `/users/unpin` - ピン留め解除
  - [x] POST `/users/reorder-pinned-notes` - ピン留め順序変更
  - [x] POST `/users/pinned-notes` - ピン留めノート一覧
- [x] プロフィール取得時にピン留めノート含める
- [ ] ActivityPub対応（featured collection）
- [ ] **[拡張]** 管理者設定可能なピン留め数上限
- [ ] **[拡張]** ピン留めカテゴリ（「お知らせ」「作品」など）
- [ ] **[拡張]** 期限付きピン留め（自動解除）

### 1.3 予約投稿（上位互換）✅ 実装済み

**本家の課題:**
- 予約投稿の編集ができない
- 繰り返し投稿ができない
- タイムゾーン考慮が不十分

**改善実装:**
- [x] 予約投稿エンティティ作成 (`scheduled_note`)
- [x] 予約投稿リポジトリ実装
- [x] 予約投稿サービス実装
- [x] APIエンドポイント実装
  - [x] POST `/notes/schedule/create` - 予約投稿作成
  - [x] POST `/notes/schedule/update` - 予約投稿編集
  - [x] POST `/notes/schedule/show` - 予約詳細
  - [x] POST `/notes/schedule/list` - 予約一覧
  - [x] POST `/notes/schedule/delete` - 予約キャンセル
- [x] スケジューラー設定（apalis）
- [x] マイグレーション作成
- [ ] **[拡張]** 繰り返し投稿（日次/週次/月次）
- [ ] **[拡張]** テンプレート変数（{date}, {count}など）
- [ ] **[拡張]** ベストタイム提案（フォロワーのアクティブ時間分析）
- [ ] **[拡張]** 下書き機能との統合
- [ ] **[拡張]** 投稿キューの一括管理

### 1.4 ワードフィルター（上位互換）✅ 実装済み

**本家の課題:**
- 正規表現のみで複雑
- コンテキストを考慮しない
- フィルター理由の記録がない

**改善実装:**
- [x] ワードフィルターエンティティ作成 (`word_filter`)
- [x] フィルターリポジトリ実装
- [x] フィルターサービス実装
- [x] APIエンドポイント実装
  - [x] POST `/word-filters/create` - フィルター作成
  - [x] POST `/word-filters/update` - フィルター更新
  - [x] POST `/word-filters/delete` - フィルター削除
  - [x] POST `/word-filters/list` - フィルター一覧
  - [x] POST `/word-filters/show` - フィルター詳細
- [x] **[拡張]** フィルターアクション選択（非表示/警告/CW自動付与）
- [x] **[拡張]** 期限付きフィルター（ネタバレ対策など）
- [x] **[拡張]** コンテキスト指定（TL/通知/検索別）
- [x] **[拡張]** フィルター統計（何回マッチしたか）
- [x] マイグレーション作成
- [ ] ノート取得時のフィルタリング適用
- [ ] 通知フィルタリング適用
- [ ] **[拡張]** フィルターグループ（プリセット）
- [ ] **[拡張]** フィルターのインポート/エクスポート

### 1.5 ノート編集（上位互換）✅ 実装済み

**本家の課題:**
- 編集履歴のUIが貧弱
- 編集通知が不十分
- 編集と削除再投稿の区別がない

**改善実装:**
- [x] ノート編集履歴エンティティ作成 (`note_edit`)
- [x] 編集リポジトリ実装（NoteRepositoryに統合）
- [x] 編集サービス実装（NoteServiceに統合）
- [x] APIエンドポイント実装
  - [x] POST `/notes/update` - ノート編集
  - [x] POST `/notes/history` - 編集履歴取得
- [x] 編集済みフラグ表示（updated_at）
- [x] マイグレーション作成
- [ ] ActivityPub Update activity対応
- [ ] POST `/notes/diff` - 差分表示
- [ ] **[拡張]** 編集時間制限（投稿後N分以内のみ）設定可能
- [ ] **[拡張]** 差分ハイライト表示
- [ ] **[拡張]** 編集理由の記録（任意）
- [ ] **[拡張]** リアクション/リノートした人への編集通知
- [ ] **[拡張]** 重大な編集の警告表示

---

## Phase 2: 発見性向上

### 2.1 アンテナ（上位互換）✅ 実装済み

**本家の課題:**
- 条件が複雑で設定しづらい
- マッチングのパフォーマンスが悪い
- アンテナ数の上限が厳しい

**改善実装:**
- [x] アンテナエンティティ作成 (`antenna`)
- [x] アンテナノートエンティティ作成 (`antenna_note`)
- [x] アンテナリポジトリ実装
- [x] アンテナサービス実装
- [x] APIエンドポイント実装
  - [x] POST `/antennas/create` - アンテナ作成
  - [x] POST `/antennas/update` - アンテナ更新
  - [x] POST `/antennas/delete` - アンテナ削除
  - [x] POST `/antennas/list` - アンテナ一覧
  - [x] POST `/antennas/show` - アンテナ詳細
  - [x] POST `/antennas/notes` - アンテナのノート一覧
  - [x] POST `/antennas/mark-all-as-read` - 既読処理
- [x] アンテナ条件
  - [x] キーワード（AND/OR）
  - [x] 除外キーワード
  - [x] ユーザー指定
  - [x] リスト指定
  - [x] ローカルのみ
  - [x] 添付ファイルあり
  - [x] 返信含む/除外
- [x] **[拡張]** マッチングの高速化（Aho-Corasickアルゴリズム）
- [x] マイグレーション作成
- [ ] ノート作成時のアンテナマッチング処理（バックグラウンド）
- [ ] **[拡張]** ビジュアルクエリビルダー（複雑な条件をGUIで）
- [ ] **[拡張]** アンテナのプレビュー（作成前にマッチ確認）
- [ ] **[拡張]** アンテナテンプレート（「イラスト」「技術」など）
- [ ] **[拡張]** アンテナの共有（公開アンテナ）
- [ ] **[拡張]** アンテナ通知設定（新着時に通知）
- [ ] **[拡張]** アンテナ統計（マッチ頻度グラフ）

### 2.2 チャンネル（上位互換）✅ 実装済み

**本家の課題:**
- チャンネルの発見性が低い
- モデレーション機能が弱い
- フェデレーション非対応

**改善実装:**
- [x] チャンネルエンティティ作成 (`channel`)
- [x] チャンネルフォローエンティティ作成 (`channel_following`)
- [x] チャンネルリポジトリ実装
- [x] チャンネルサービス実装
- [x] APIエンドポイント実装
  - [x] POST `/channels/create` - チャンネル作成
  - [x] POST `/channels/update` - チャンネル更新
  - [x] POST `/channels/delete` - チャンネル削除 (アーカイブ)
  - [x] POST `/channels/show` - チャンネル詳細
  - [x] POST `/channels/featured` - おすすめチャンネル
  - [x] POST `/channels/followed` - フォロー中チャンネル
  - [x] POST `/channels/owned` - 自分のチャンネル
  - [x] POST `/channels/search` - チャンネル検索
  - [x] POST `/channels/follow` - チャンネルフォロー
  - [x] POST `/channels/unfollow` - フォロー解除
- [x] マイグレーション作成
- [ ] ノートのチャンネル投稿対応
- [ ] POST `/channels/timeline` - チャンネルタイムライン
- [ ] チャンネルタイムラインのストリーミング
- [ ] **[拡張]** チャンネルカテゴリ/タグ
- [ ] **[拡張]** チャンネルモデレーター機能
- [ ] **[拡張]** チャンネル内ミュート/ブロック
- [ ] **[拡張]** チャンネルルール設定
- [ ] **[拡張]** スレッド形式の返信（ディスカッション向け）
- [ ] **[拡張]** チャンネルのActivityPub対応（Group actor）
- [ ] **[拡張]** チャンネル統計（アクティブユーザー、投稿頻度）

### 2.3 インスタンスブロック/サイレンス（上位互換）✅ 実装済み

**本家の課題:**
- ブロック理由の記録がない
- 一時的なブロックができない
- ブロック判断の根拠が分かりにくい

**改善実装:**
- [x] インスタンスエンティティ（ブロック/サイレンス/サスペンドフラグ）
- [x] インスタンスリポジトリ実装
- [x] インスタンスサービス実装
- [x] APIエンドポイント実装（管理者用）
  - [x] POST `/admin/federation/update-instance` - インスタンス設定更新
  - [x] POST `/admin/federation/list-blocked` - ブロック一覧
  - [x] POST `/admin/federation/list-silenced` - サイレンス一覧
  - [x] POST `/admin/federation/instance-stats` - インスタンス統計
  - [x] POST `/admin/federation/list` - インスタンス一覧
  - [x] POST `/admin/federation/show` - インスタンス詳細
  - [x] POST `/admin/federation/search` - インスタンス検索
- [x] **[拡張]** ブロック理由の記録（moderation_note）
- [x] マイグレーション作成
- [ ] 受信時のブロック/サイレンスチェック
- [ ] 配信時のブロックインスタンス除外
- [ ] **[拡張]** 期限付きブロック（自動解除）
- [ ] **[拡張]** ブロックレベル（完全遮断/サイレンス/メディアのみ）
- [ ] **[拡張]** インスタンスレピュテーションスコア
- [ ] **[拡張]** 他インスタンスのブロックリスト購読
- [ ] **[拡張]** ブロック前の影響プレビュー（何ユーザー影響するか）
- [ ] **[拡張]** 段階的ブロック（警告→サイレンス→ブロック）

---

## Phase 3: セキュリティ強化

### 3.1 2要素認証（上位互換）✅ 実装済み

**本家の課題:**
- TOTPのみでバックアップ手段が限定的
- リカバリーフローが分かりにくい

**改善実装:**
- [x] TOTPライブラリ導入 (totp-rs)
- [x] 2FAサービス実装
- [x] APIエンドポイント実装
  - [x] POST `/i/2fa/register` - 2FA登録開始
  - [x] POST `/i/2fa/confirm` - 2FA登録完了
  - [x] POST `/i/2fa/disable` - 2FA解除
  - [x] POST `/i/2fa/status` - 2FAステータス確認
  - [x] POST `/i/2fa/regenerate-backup-codes` - バックアップコード再生成
- [x] バックアップコード対応
- [x] QRコード生成
- [ ] ログイン時の2FA検証
- [ ] **[拡張]** 複数の2FA方式併用（TOTP + WebAuthn）
- [ ] **[拡張]** 信頼済みデバイス管理
- [ ] **[拡張]** ログイン通知（新規デバイスからのアクセス）
- [ ] **[拡張]** セッション一覧と強制ログアウト
- [ ] **[拡張]** 2FA強制設定（管理者/モデレーター必須）

### 3.2 レート制限（上位互換）✅ 実装済み

**本家の課題:**
- レート制限が固定で調整できない
- 制限状況の可視性が低い

**改善実装:**
- [x] レート制限ミドルウェア実装
- [x] エンドポイント別制限設定（STANDARD/WRITE/HEAVY/AUTH/SIGNUP）
- [x] インメモリカウンター実装
- [x] レート制限ヘッダー追加（X-RateLimit-*）
- [x] 制限設定
  - [x] 認証済み/匿名別制限
  - [x] エンドポイント別制限
  - [x] IPベース制限
- [ ] Redis使用のカウンター実装（分散環境対応）
- [ ] **[拡張]** スライディングウィンドウ方式
- [ ] **[拡張]** 管理者設定可能な制限値
- [ ] **[拡張]** ユーザーロール別制限（通常/Premium/Bot）
- [ ] **[拡張]** レート制限ダッシュボード（管理者用）
- [ ] **[拡張]** 一時的なレート制限緩和/強化
- [ ] **[拡張]** APIキー別のクォータ管理

### 3.3 OAuth 2.0（上位互換）✅ 実装済み

**本家の課題:**
- 対応プロバイダーが限定的
- OIDC標準への対応が不十分

**改善実装:**
- [x] OAuth 2.0 Authorization Code Flow with PKCE
- [x] OAuthアプリエンティティ (`oauth_app`)
- [x] OAuthトークンエンティティ (`oauth_token`)
- [x] OAuthリポジトリ実装
- [x] OAuthサービス実装
- [x] APIエンドポイント実装
  - [x] POST `/oauth/apps/create` - アプリ作成
  - [x] POST `/oauth/apps/update` - アプリ更新
  - [x] POST `/oauth/apps/delete` - アプリ削除
  - [x] POST `/oauth/apps/list` - アプリ一覧
  - [x] POST `/oauth/apps/show` - アプリ詳細
  - [x] POST `/oauth/authorize` - 認証開始
  - [x] POST `/oauth/token` - トークン交換
  - [x] POST `/oauth/revoke` - トークン無効化
  - [x] POST `/oauth/authorized-apps` - 認可済みアプリ一覧
- [x] スコープベースの権限管理
- [x] マイグレーション作成
- [ ] 外部OAuthプロバイダー連携（GitHub, Discord等）
- [ ] **[拡張]** 自動アカウント作成（SSO）
- [ ] **[拡張]** 組織/ドメイン制限（特定ドメインのみ許可）
- [ ] **[拡張]** SAML対応（企業向け）

### 3.4 セキュリティキー WebAuthn（上位互換）✅ 実装済み

**本家の課題:**
- パスキー対応が不十分
- クロスプラットフォームの考慮不足

**改善実装:**
- [x] WebAuthnライブラリ導入 (webauthn-rs)
- [x] セキュリティキーエンティティ (`security_key`)
- [x] WebAuthnサービス実装
- [x] APIエンドポイント実装
  - [x] POST `/i/security-keys/register` - 登録開始
  - [x] POST `/i/security-keys/complete` - 登録完了
  - [x] POST `/i/security-keys/remove` - 削除
  - [x] POST `/i/security-keys/list` - 一覧
  - [x] POST `/i/security-keys/update` - 名前変更
- [x] **[拡張]** セキュリティキーのニックネーム管理
- [x] マイグレーション作成
- [ ] ログイン時のWebAuthn検証
- [ ] **[拡張]** パスキー（Passkey）フルサポート
- [ ] **[拡張]** プラットフォーム認証器（Face ID, Windows Hello）
- [ ] **[拡張]** パスワードレスログイン
- [ ] **[拡張]** クロスデバイス認証（QRコード）

---

## Phase 4: 高度な機能

### 4.1 ページ/記事（上位互換）✅ 実装済み

**本家の課題:**
- ブロックエディタが使いにくい
- SEO対応が不十分
- バージョン管理がない

**改善実装:**
- [x] ページエンティティ作成 (`page`)
- [x] ページいいねエンティティ作成 (`page_like`)
- [x] ページリポジトリ実装
- [x] ページサービス実装
- [x] APIエンドポイント実装
  - [x] POST `/pages/create` - ページ作成
  - [x] POST `/pages/update` - ページ更新
  - [x] POST `/pages/delete` - ページ削除
  - [x] POST `/pages/show` - ページ表示
  - [x] POST `/pages/list` - ページ一覧
  - [x] POST `/pages/like` - いいね
  - [x] POST `/pages/unlike` - いいね解除
  - [x] POST `/pages/featured` - おすすめページ
- [x] JSONベースのコンテンツ形式
- [x] **[拡張]** カスタムURL（スラッグ）
- [x] マイグレーション作成
- [ ] ページブロックタイプの構造化
- [ ] **[拡張]** ページ下書き・プレビュー
- [ ] **[拡張]** バージョン履歴・ロールバック
- [ ] **[拡張]** SEOメタデータ（OGP、構造化データ）
- [ ] **[拡張]** ページテンプレート
- [ ] **[拡張]** 共同編集

### 4.2 ギャラリー（上位互換）✅ 実装済み

**本家の課題:**
- アルバム機能がない
- タグ付けが不十分

**改善実装:**
- [x] ギャラリー投稿エンティティ作成 (`gallery_post`)
- [x] ギャラリーいいねエンティティ作成 (`gallery_like`)
- [x] ギャラリーリポジトリ実装
- [x] ギャラリーサービス実装
- [x] APIエンドポイント実装
  - [x] POST `/gallery/posts/create` - 投稿作成
  - [x] POST `/gallery/posts/update` - 投稿更新
  - [x] POST `/gallery/posts/delete` - 投稿削除
  - [x] POST `/gallery/posts/show` - 投稿詳細
  - [x] POST `/gallery/posts` - 投稿一覧
  - [x] POST `/gallery/posts/like` - いいね
  - [x] POST `/gallery/posts/unlike` - いいね解除
  - [x] POST `/gallery/featured` - おすすめ
  - [x] POST `/gallery/popular` - 人気
  - [x] POST `/gallery/posts/user` - ユーザーの投稿一覧
  - [x] POST `/gallery/posts/mine` - 自分の投稿一覧
  - [x] POST `/gallery/posts/liked` - いいねした投稿一覧
  - [x] POST `/gallery/search/tag` - タグ検索
- [x] **[拡張]** タグ・カテゴリ
- [x] マイグレーション作成
- [ ] **[拡張]** アルバム機能（複数画像のグループ化）
- [ ] **[拡張]** 撮影情報（EXIF）表示
- [ ] **[拡張]** ライセンス表示（CC等）
- [ ] **[拡張]** ギャラリービュー（グリッド/カルーセル）
- [ ] **[拡張]** ユーザーポートフォリオページ
- [ ] **[拡張]** コンテスト/キュレーション機能

### 4.3 翻訳機能（上位互換）✅ 実装済み

**本家の課題:**
- プロバイダー選択肢が少ない
- ローカルLLMに対応していない

**改善実装:**
- [x] 翻訳サービス抽象化
- [x] 翻訳プロバイダー実装
  - [x] DeepL
  - [x] Google Translate
  - [x] LibreTranslate（セルフホスト対応）
  - [x] **[拡張]** OpenAI API
  - [x] **[拡張]** Anthropic Claude API
  - [x] **[拡張]** ローカルLLM（Ollama連携）
- [x] APIエンドポイント実装
  - [x] POST `/translate/note` - ノート翻訳
  - [x] POST `/translate/text` - テキスト翻訳
  - [x] POST `/translate/detect` - 言語検出
  - [x] POST `/translate/languages` - サポート言語一覧
  - [x] POST `/translate/status` - 翻訳サービスステータス
- [x] 翻訳キャッシュ
- [x] **[拡張]** 言語自動検出
- [ ] **[拡張]** ユーザーデフォルト言語設定
- [ ] **[拡張]** 自動翻訳オプション（特定言語から自動）
- [ ] **[拡張]** 翻訳品質フィードバック
- [ ] **[拡張]** MFM構文の保持

### 4.4 プッシュ通知（上位互換）✅ 実装済み

**本家の課題:**
- 通知のカスタマイズ性が低い
- 通知グループ化がない

**改善実装:**
- [x] Web Push設定エンティティ (`push_subscription`)
- [x] プッシュ通知サービス実装
- [x] APIエンドポイント実装
  - [x] POST `/sw/register` - Service Worker登録
  - [x] POST `/sw/unregister` - 登録解除
  - [x] POST `/sw/update` - 設定更新
  - [x] POST `/sw/list` - 登録一覧
  - [x] POST `/sw/show` - 登録詳細
  - [x] POST `/sw/config` - 設定取得（VAPID公開鍵）
- [x] 通知タイプ別設定
- [x] **[拡張]** 静かな時間帯設定（通知抑制）
- [x] **[拡張]** デバイス別通知設定
- [x] VAPID認証対応
- [x] マイグレーション作成
- [ ] 通知送信ジョブ実装（ワーカー）
- [ ] **[拡張]** 通知グループ化（同一ノートへの複数リアクションをまとめる）
- [ ] **[拡張]** 重要度レベル（緊急/通常/低）
- [ ] **[拡張]** リッチ通知（画像プレビュー、アクションボタン）

### 4.5 メール通知（上位互換）✅ 実装済み

**本家の課題:**
- メールテンプレートのカスタマイズ不可
- ダイジェスト機能が限定的

**改善実装:**
- [x] メールテンプレート作成（HTMLメール対応）
- [x] メール送信サービス実装
- [x] SMTP設定
- [x] 通知タイプ
  - [x] フォロー通知
  - [x] メンション通知
  - [x] ダイジェスト（週次/月次）
  - [x] パスワードリセット
  - [x] メール確認
  - [x] セキュリティアラート
  - [x] ウェルカムメール
- [x] **[拡張]** HTMLメールテンプレート（レスポンシブ対応）
- [x] **[拡張]** 複数メールプロバイダー対応（SMTP, SES, SendGrid, Mailgun）
- [ ] メール設定APIエンドポイント
- [ ] **[拡張]** インテリジェントダイジェスト（アクティビティベース）
- [ ] **[拡張]** ワンクリック登録解除
- [ ] **[拡張]** メール到達率モニタリング

### 4.6 メディア処理（上位互換）✅ 実装済み

**本家の課題:**
- サムネイル生成が遅い
- 最新フォーマット対応が遅れがち

**改善実装:**
- [x] 画像処理サービス設計（image-rs統合準備）
- [x] サムネイル生成インターフェース
- [x] 画像リサイズインターフェース
- [x] WebP変換設定
- [x] AVIF変換設定（オプション）
- [x] 動画処理インターフェース（ffmpeg連携）
  - [x] サムネイル抽出
  - [x] メタデータ取得
- [x] Blurhash生成インターフェース
- [x] 画像フォーマット自動検出
- [x] 画像メタデータ抽出（EXIF対応）
- [x] **[拡張]** 動画トランスコード（HLS/DASH）インターフェース
- [x] **[拡張]** GIF→WebM/MP4自動変換インターフェース
- [ ] image-rs実装の完全統合
- [ ] **[拡張]** 遅延処理（アップロード後バックグラウンド変換）
- [ ] **[拡張]** アダプティブフォーマット（クライアント能力に応じて）
- [ ] **[拡張]** 画像最適化（品質/サイズ自動調整）
- [ ] **[拡張]** 外部ストレージ対応強化（R2, B2, MinIO）
- [ ] **[拡張]** CDN連携（キャッシュパージAPI）

---

## Phase 5: アカウント管理

### 5.1 アカウント移行（上位互換）✅ 実装済み

**本家の課題:**
- 移行プロセスが分かりにくい
- 移行後のリダイレクトが不十分

**改善実装:**
- [x] アカウントサービス作成（AccountService）
- [x] also_known_as/moved_to_uri フィールド追加
- [x] APIエンドポイント実装
  - [x] POST `/i/account/migrate` - 移行実行
  - [x] POST `/i/account/aliases` - エイリアス設定
  - [x] POST `/i/account/migration/status` - 移行ステータス確認
  - [x] POST `/i/account/migration/cancel` - 移行キャンセル
- [x] マイグレーション作成
- [ ] ActivityPub Move activity対応
- [ ] フォロワー移行処理
- [ ] **[拡張]** 移行ウィザード（ステップバイステップガイド）
- [ ] **[拡張]** 移行プレビュー（影響範囲確認）
- [ ] **[拡張]** 移行進捗トラッキング
- [ ] **[拡張]** 旧アカウントへのリダイレクト設定
- [ ] **[拡張]** 移行通知（フォロワーへの自動通知）

### 5.2 アカウント削除（上位互換）✅ 実装済み

**本家の課題:**
- 即座に削除されるため取り消しが難しい
- 削除後のデータ残存が不明確

**改善実装:**
- [x] 削除サービス実装（AccountServiceに統合）
- [x] APIエンドポイント実装
  - [x] POST `/i/account/delete` - 削除リクエスト
  - [x] POST `/i/account/deletion/status` - 削除ステータス
  - [x] POST `/i/account/deletion/cancel` - 削除キャンセル
- [x] **[拡張]** 猶予期間設定（ソフト削除30日、ハード削除7日）
- [x] **[拡張]** 段階的削除（まず非表示→完全削除）
- [ ] データ削除ジョブ実装
- [ ] ActivityPub Delete activity配信
- [ ] **[拡張]** 削除前のデータエクスポート促進
- [ ] **[拡張]** 削除証明書（GDPR対応）
- [ ] **[拡張]** 関連データの完全削除確認

### 5.3 アカウントエクスポート（上位互換）✅ 実装済み

**本家の課題:**
- エクスポート形式が限定的
- 大量データのエクスポートが遅い

**改善実装:**
- [x] エクスポートサービス実装（AccountServiceに統合）
- [x] エクスポート形式定義
  - [x] プロフィール (JSON)
  - [x] フォロー/フォロワー (JSON)
- [x] APIエンドポイント実装
  - [x] POST `/i/account/export` - エクスポートジョブ作成
  - [x] POST `/i/account/export/profile` - プロフィール即時エクスポート
  - [x] POST `/i/account/export/following` - フォローエクスポート
  - [x] POST `/i/account/export/followers` - フォロワーエクスポート
  - [x] POST `/i/account/export/status` - エクスポートステータス
  - [x] POST `/i/account/data-types` - 利用可能データタイプ一覧
- [ ] ノート (JSON/CSV)エクスポート
- [ ] ブロック/ミュートエクスポート
- [ ] エクスポートジョブ実装（バックグラウンド）
- [ ] **[拡張]** ActivityPub形式（Actor + Outbox）
- [ ] **[拡張]** 差分エクスポート（前回以降の変更のみ）
- [ ] **[拡張]** 自動定期エクスポート
- [ ] **[拡張]** 暗号化エクスポート
- [ ] **[拡張]** クラウドストレージ直接出力

### 5.4 アカウントインポート（上位互換）✅ 実装済み

**本家の課題:**
- インポート元の形式対応が限定的
- 大量インポート時の処理が遅い

**改善実装:**
- [x] インポートサービス実装（AccountServiceに統合）
- [x] インポート形式
  - [x] フォロー (CSV/JSON)
- [x] APIエンドポイント実装
  - [x] POST `/i/account/import` - インポートジョブ作成
  - [x] POST `/i/account/import/following` - フォローインポート
  - [x] POST `/i/account/import/status` - インポートステータス
- [x] **[拡張]** インポート進捗トラッキング
- [x] **[拡張]** 重複チェック・スキップ
- [x] **[拡張]** エラー詳細レポート
- [ ] ブロック (CSV)インポート
- [ ] ミュート (CSV)インポート
- [ ] インポートジョブ実装（バックグラウンド）
- [ ] **[拡張]** Mastodon形式
- [ ] **[拡張]** Twitter/Xアーカイブ
- [ ] **[拡張]** ActivityPub形式
- [ ] **[拡張]** インポートプレビュー（実行前確認）
- [ ] **[拡張]** バッチ処理（大量データ対応）

---

## Phase 6: グループ機能（上位互換）

**本家の課題:**
- グループ機能が廃止された
- コミュニティ形成手段が限られている

**改善実装（新規設計）:**

### 6.1 グループ基盤
- [ ] グループエンティティ作成 (`group`)
- [ ] グループメンバーエンティティ作成 (`group_member`)
- [ ] グループ招待エンティティ作成 (`group_invite`)
- [ ] グループリポジトリ実装
- [ ] グループサービス実装

### 6.2 グループAPI
- [ ] APIエンドポイント実装
  - [ ] POST `/groups/create` - グループ作成
  - [ ] POST `/groups/update` - グループ更新
  - [ ] POST `/groups/delete` - グループ削除
  - [ ] POST `/groups/show` - グループ詳細
  - [ ] POST `/groups/owned` - 自分のグループ
  - [ ] POST `/groups/joined` - 参加中グループ
  - [ ] POST `/groups/invite` - 招待
  - [ ] POST `/groups/invitations/accept` - 招待承認
  - [ ] POST `/groups/invitations/reject` - 招待拒否
  - [ ] POST `/groups/leave` - グループ退出
  - [ ] POST `/groups/transfer` - オーナー移譲
  - [ ] POST `/groups/members` - メンバー一覧
  - [ ] POST `/groups/kick` - メンバー追放

### 6.3 グループ拡張機能
- [ ] **[拡張]** グループタイプ（オープン/招待制/承認制）
- [ ] **[拡張]** ロールシステム（管理者/モデレーター/メンバー）
- [ ] **[拡張]** グループ内限定ノート
- [ ] **[拡張]** グループDM（グループチャット）
- [ ] **[拡張]** グループイベント/カレンダー
- [ ] **[拡張]** グループファイル共有
- [ ] **[拡張]** ActivityPub Group actor対応
- [ ] **[拡張]** グループ間フェデレーション

---

## Phase 7: 独自機能（Misskey-rs オリジナル）

### 7.1 GraphQL API
- [ ] GraphQLスキーマ設計
- [ ] async-graphql導入
- [ ] リゾルバー実装
  - [ ] Query（読み取り）
  - [ ] Mutation（書き込み）
  - [ ] Subscription（リアルタイム）
- [ ] DataLoaderによるN+1解決
- [ ] GraphQL Playground
- [ ] スキーマドキュメント自動生成
- [ ] REST API との併用

### 7.2 Webhook システム ✅ 実装済み
- [x] Webhookエンティティ作成 (`webhook`)
- [x] Webhookリポジトリ実装
- [x] Webhookサービス実装
- [x] APIエンドポイント実装
  - [x] POST `/i/webhooks/create` - Webhook作成
  - [x] POST `/i/webhooks/update` - Webhook更新
  - [x] POST `/i/webhooks/delete` - Webhook削除
  - [x] POST `/i/webhooks/list` - Webhook一覧
  - [x] POST `/i/webhooks/show` - Webhook詳細
  - [x] POST `/i/webhooks/test` - テスト送信
- [x] イベントタイプ対応
- [x] 署名検証（HMAC-SHA256）
- [x] マイグレーション作成
- [ ] Webhook配信ジョブワーカー
- [ ] リトライ機構
- [ ] 配信ログ

### 7.3 プラグインシステム
- [ ] プラグインマニフェスト仕様
- [ ] プラグインサンドボックス（WASM）
- [ ] プラグインAPI
  - [ ] イベントフック
  - [ ] UI拡張ポイント
  - [ ] カスタムエンドポイント
- [ ] プラグインマーケットプレイス
- [ ] プラグイン設定管理

### 7.4 高度な検索
- [ ] 全文検索エンジン（Meilisearch/Elasticsearch）
- [ ] 高度なクエリ構文
  - [ ] AND/OR/NOT
  - [ ] フレーズ検索
  - [ ] 日付範囲
  - [ ] ユーザー指定
  - [ ] 添付ファイルタイプ
- [ ] 検索結果ハイライト
- [ ] 検索サジェスト
- [ ] 保存された検索（アンテナ統合）
- [ ] 検索分析（人気検索ワード）

### 7.5 分析・統計ダッシュボード
- [ ] ユーザー向け統計
  - [ ] エンゲージメント分析
  - [ ] フォロワー成長グラフ
  - [ ] 投稿パフォーマンス
  - [ ] ベストポスト時間帯
- [ ] 管理者向け統計
  - [ ] インスタンス健全性
  - [ ] アクティブユーザー推移
  - [ ] フェデレーション統計
  - [ ] リソース使用状況
- [ ] エクスポート可能なレポート

### 7.6 AI/LLM 統合
- [ ] AIプロバイダー抽象化
- [ ] サポートプロバイダー
  - [ ] OpenAI
  - [ ] Anthropic Claude
  - [ ] ローカルLLM (Ollama)
- [ ] 機能
  - [ ] コンテンツ要約
  - [ ] 返信サジェスト
  - [ ] 自動CW提案
  - [ ] スパム検出
  - [ ] 感情分析
  - [ ] 画像説明生成（アクセシビリティ）
- [ ] プライバシー設定（オプトイン）
- [ ] ローカル処理オプション

### 7.7 高度なモデレーション
- [ ] 自動モデレーション
  - [ ] キーワードベースの自動検出
  - [ ] 画像のNSFW自動判定
  - [ ] スパムパターン検出
- [ ] モデレーションキュー
  - [ ] 優先度付きキュー
  - [ ] モデレーター割り当て
  - [ ] 対応履歴
- [ ] アピールシステム
  - [ ] 処分への異議申し立て
  - [ ] アピール審査フロー
- [ ] モデレーションログ（監査）
- [ ] 複数インスタンス間のモデレーション連携

### 7.8 アクセシビリティ強化
- [ ] 画像の自動ALTテキスト生成
- [ ] 動画の自動字幕生成
- [ ] スクリーンリーダー最適化API
- [ ] ハイコントラストモード対応
- [ ] 減モーション設定
- [ ] キーボードナビゲーション完全対応

### 7.9 パフォーマンス・スケーラビリティ
- [ ] 読み取りレプリカ対応
- [ ] 地理分散対応
- [ ] タイムライン事前計算
- [ ] アグレッシブキャッシング
- [ ] コネクションプーリング最適化
- [ ] メモリ効率化（アリーナアロケータ）

### 7.10 開発者向け機能
- [ ] OpenAPI 3.1 スキーマ自動生成
- [ ] SDK生成（Rust/TypeScript/Python）
- [ ] APIバージョニング（v1/v2）
- [ ] 開発者ポータル
- [ ] APIキー管理
- [ ] レート制限ダッシュボード
- [ ] サンドボックス環境

---

## 進捗サマリー

| Phase | 項目数 | 完了 | 進捗 |
|-------|-------|------|------|
| Phase 1: 基本機能補完 | 5 | 5 | 100% |
| Phase 2: 発見性向上 | 3 | 3 | 100% |
| Phase 3: セキュリティ強化 | 4 | 4 | 100% |
| Phase 4: 高度な機能 | 6 | 6 | 100% |
| Phase 5: アカウント管理 | 4 | 4 | 100% |
| Phase 6: グループ機能 | 3 | 0 | 0% |
| Phase 7: 独自機能 | 10 | 1 | 10% |
| **合計** | **35** | **23** | **66%** |

---

## 実装の優先順位

### Tier 1: 即時対応（ユーザー体験に直結）
1. クリップ機能
2. ノートピン留め
3. レート制限
4. ノート編集

### Tier 2: 短期対応（基本機能強化）
5. ワードフィルター
6. 予約投稿
7. 2要素認証
8. WebAuthn/パスキー

### Tier 3: 中期対応（発見性・コミュニティ）
9. アンテナ
10. チャンネル
11. インスタンスブロック
12. 高度な検索

### Tier 4: 長期対応（高度な機能）
13. ページ/記事
14. ギャラリー
15. OAuth/外部認証
16. アカウント移行/削除
17. グループ

### Tier 5: 差別化機能
18. GraphQL API
19. Webhook システム
20. AI/LLM 統合
21. プラグインシステム

---

## 技術的な注意点

### データベース
- 新規エンティティはSeaORM形式で作成
- マイグレーションファイルの命名規則: `m{YYYYMMDD}_{NNNNNN}_{description}.rs`
- インデックス設計を忘れずに
- 大規模テーブルはパーティショニングを検討

### API
- Axum 0.8のルーティング形式 (`/{param}`)
- 認証ミドルウェアの適用
- バリデーションはvalidatorクレートを使用
- エラーはAppErrorに統一
- **[上位互換]** GraphQL対応を見据えた設計
- **[上位互換]** バッチAPI対応

### フェデレーション
- 新規オブジェクトタイプはActivityPub仕様に準拠
- Misskey拡張プロパティは `_misskey_` プレフィックス
- 互換性テストの追加
- **[上位互換]** FEP（Fediverse Enhancement Proposals）への対応

### テスト
- 単体テストはMockDatabaseを使用
- 統合テストはdocker-compose.test.yml環境
- フェデレーションテストは2インスタンス構成
- **[上位互換]** プロパティベーステスト導入

### パフォーマンス
- **[上位互換]** DataLoaderパターンでN+1解決
- **[上位互換]** ストリーミング処理でメモリ効率化
- **[上位互換]** 非同期処理の最大活用

---

## 差別化ポイントまとめ

| カテゴリ | 本家Misskey | Misskey-rs（目標） |
|---------|------------|-------------------|
| 言語 | TypeScript | Rust |
| パフォーマンス | 基準 | 10倍以上 |
| メモリ使用量 | 高 | 1/4以下 |
| 型安全性 | 部分的 | 完全 |
| API | REST only | REST + GraphQL |
| 拡張性 | 限定的 | プラグインシステム |
| AI統合 | なし | LLM連携対応 |
| 検索 | 基本的 | 全文検索エンジン |
| モデレーション | 手動中心 | AI支援モデレーション |
| 開発者体験 | APIドキュメントのみ | SDK + ポータル + サンドボックス |
